#!/usr/bin/ruby
require_relative '../lib/eggshell.rb'

f = ARGV[0]
if !f || !File.exists?(f)
	puts "Invalid file: #{f}"
	exit
end

$eggshell = Eggshell::Processor.new
$eggshell.vars[:include_paths] << File.realdirpath(File.dirname(f))
Eggshell::Bundles::Registry.attach_bundle('basics', $eggshell)

home = Dir.home
if File.exists?("#{home}/.eggshell")
	require_relative '../lib/eggshell/bundles/loader.rb'
	$loader = Eggshell::Processor.new
	$loader.vars[:target] = $eggshell
	Eggshell::Bundles::Registry.attach_bundle('loader', $loader)
	$loader.process(IO.readlines("#{home}/.eggshell"))
	$eggshell._info("loaded ~/.eggshell")
end

# @todo parse any additional opts via command line or local project?

$eggshell._info("PROCESSING #{f}")
output = $eggshell.process(IO.readlines(f))
puts output